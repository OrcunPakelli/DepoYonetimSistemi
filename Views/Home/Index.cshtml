@model IEnumerable<DepoYonetimSistemi.Models.Product>

@{
    // Query stringden gelen değerleri array'e dönüştürme
    string?[] selectedCpuIds        = Context.Request.Query["cpuId"].ToArray();
    string?[] selectedGpuIds        = Context.Request.Query["gpuId"].ToArray();
    string?[] selectedRamSizes      = Context.Request.Query["ramSize"].ToArray();
    string?[] selectedRamTypes      = Context.Request.Query["ramType"].ToArray();
    string?[] selectedStorCaps      = Context.Request.Query["storageCapacity"].ToArray();
    string?[] selectedStorTypes     = Context.Request.Query["storageType"].ToArray();
    string?[] selectedScreenSizes   = Context.Request.Query["screenSize"].ToArray();
    string?[] selectedScreenReses   = Context.Request.Query["screenResolution"].ToArray();
    string?[] selectedWarehouseIds  = Context.Request.Query["warehouseId"].ToArray();
}

@{
    var totalProductCount = Model.Count();
}

<h2 class="mb-3">Ürün Listesi</h2>

<div class="mb-2 fw-bold">
    Toplam Ürün Sayısı: @totalProductCount
</div>

<button id="filterToggleBtn" class="filter-toggle-btn" type="button">
    <i id="filterArrow" class="fa-solid fa-chevron-down"></i>
    Filtreler
</button>

<!-- FİLTRE PANELİ -->
<div id="filterPanel" class="filter-panel mb-4">

    <form asp-action="Index" method="get">

        <!-- SERİ NO / MARKA / MODEL -->
        <div class="row mb-3">
            <div class="col-md-4">
                <label class="form-label">Seri No</label>
                <input type="text" name="serialNumber" class="form-control"
                       value="@(Context.Request.Query["serialNumber"])" />
            </div>

            <div class="col-md-4">
                <label class="form-label">Marka</label>
                <input type="text" name="brand" class="form-control"
                       value="@(Context.Request.Query["brand"])" />
            </div>

            <div class="col-md-4">
                <label class="form-label">Model</label>
                <input type="text" name="model" class="form-control"
                       value="@(Context.Request.Query["model"])" />
            </div>
        </div>

        <!-- CHECKBOX GRUPLARI -->
        <div class="row">

            <!-- DEPO -->
            <div class="col-md-4 mb-3">
                <label class="fw-bold">Depo</label>
                @foreach (var wh in ViewBag.Warehouses)
                {
                    bool isChecked = Array.IndexOf(selectedWarehouseIds, wh.WarehouseId.ToString()) >= 0;
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               name="warehouseId" value="@wh.WarehouseId"
                               @(isChecked ? "checked" : "") />
                        <label class="form-check-label">@wh.WarehouseName</label>
                    </div>
                }
            </div>

            <!-- CPU -->
            <div class="col-md-4 mb-3">
                <label class="fw-bold">CPU</label>
                @foreach (var cpu in ViewBag.Cpus)
                {
                    bool isChecked = Array.IndexOf(selectedCpuIds, cpu.CpuId.ToString()) >= 0;
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               name="cpuId" value="@cpu.CpuId"
                               @(isChecked ? "checked" : "") />
                        <label class="form-check-label">
                            @cpu.Manufacturer @cpu.Model (@cpu.Cores çekirdek)
                        </label>
                    </div>
                }
            </div>

            <!-- GPU -->
            <div class="col-md-4 mb-3">
                <label class="fw-bold">GPU</label>
                @foreach (var gpu in ViewBag.Gpus)
                {
                    bool isChecked = Array.IndexOf(selectedGpuIds, gpu.GpuId.ToString()) >= 0;
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               name="gpuId" value="@gpu.GpuId"
                               @(isChecked ? "checked" : "") />
                        <label class="form-check-label">
                            @gpu.Manufacturer @gpu.Model (@gpu.Memory)
                        </label>
                    </div>
                }
            </div>

        </div>

        <!-- ALT SATIR -->
        <div class="row">

            <div class="col-md-3 mb-3">
                <label class="fw-bold">RAM Tipi</label>
                @foreach (var type in ViewBag.RamTypes)
                {
                    bool isChecked = Array.IndexOf(selectedRamTypes, (string?)type) >= 0;
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               name="ramType" value="@type"
                               @(isChecked ? "checked" : "") />
                        <label class="form-check-label">@type</label>
                    </div>
                }
            </div>

            <div class="col-md-3 mb-3">
                <label class="fw-bold">RAM Boyutu</label>
                @foreach (var size in ViewBag.RamSizes)
                {
                    bool isChecked = Array.IndexOf(selectedRamSizes, size.ToString()) >= 0;
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               name="ramSize" value="@size"
                               @(isChecked ? "checked" : "") />
                        <label class="form-check-label">@size GB</label>
                    </div>
                }
            </div>

            <div class="col-md-3 mb-3">
                <label class="fw-bold">Depolama</label>
                @foreach (var cap in ViewBag.StorageCapacities)
                {
                    bool isChecked = Array.IndexOf(selectedStorCaps, cap.ToString()) >= 0;
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               name="storageCapacity" value="@cap"
                               @(isChecked ? "checked" : "") />
                        <label class="form-check-label">@cap GB</label>
                    </div>
                }
            </div>

            <div class="col-md-3 mb-3">
                <label class="fw-bold">Çözünürlük</label>
                @foreach (var res in ViewBag.ScreenResolutions)
                {
                    bool isChecked = Array.IndexOf(selectedScreenReses, (string?)res) >= 0;
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               name="screenResolution" value="@res"
                               @(isChecked ? "checked" : "") />
                        <label class="form-check-label">@res</label>
                    </div>
                }
            </div>

        </div>

        <div class="d-flex gap-2 mt-3">
            <button type="submit" class="btn btn-primary w-50">Filtrele</button>
            <a asp-action="Index" class="btn btn-outline-secondary w-50">Temizle</a>
        </div>

    </form>
</div>

<!-- Ürün tablosu -->
<div class="Table">
<table class="styled-table">
    <thead>
        <tr>
            <th>Marka</th>
            <th>Model</th>
            <th>Ürün Kodu</th>
            <th>Depo</th>
            <th>Konum</th>
            <th>CPU</th>
            <th>GPU</th>
            <th>RAM</th>
            <th>Depolama</th>
            <th>Ekran</th>
            <th>Seri No</th>
        </tr>
    </thead>

    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Brand</td>
                <td>@item.Model</td>
                <td>@item.SerialNumber</td>

                <!-- Depo -->
                <td>
                    @if (item.ProductStocks.Any())
                    {
                        foreach (var st in item.ProductStocks)
                        {
                            @st.Warehouse?.WarehouseName
                        }
                    }
                    else
                    {

                        <span class="text-muted">-</span>
                    }
                </td>

                <!-- Konum -->
                <td>
                    @if (item.Location != null)
                    {
                        <div>@item.Location.Aisle @item.Location.Shelf @item.Location.Bin</div>
                        <div></div>
                        <div></div>
                    }
                    else
                    {

                        <span class="text-muted">-</span>
                    }
                </td>

                <!-- CPU -->
                <td>
                    @foreach (var cpu in item.ProductCpus)
                    {
                        <div>@cpu.Cpu.Manufacturer @cpu.Cpu.Model</div>
                    }
                </td>

                <!-- GPU -->
                <td>
                    @foreach (var gpu in item.ProductGpus)
                    {
                        <div>@gpu.Gpu.Manufacturer @gpu.Gpu.Model</div>
                    }
                </td>

                <!-- RAM -->
                <td>
                    @foreach (var ram in item.ProductRams)
                    {
                        <div>@ram.Ram.Manufacturer @ram.Ram.Model - @ram.Ram.SizeGB GB</div>
                    }
                </td>

                <!-- Depolama -->
                <td>
                    @foreach (var sto in item.ProductStorages)
                    {
                        <div>@sto.Storage.Manufacturer @sto.Storage.Model - @sto.Storage.CapacityGB GB @sto.Storage.Type</div>
                    }
                </td>

                <!-- Ekran -->
                <td>
                    @foreach (var sc in item.ProductScreens)
                    {
                        <div>@sc.Screen.SizeInches" - @sc.Screen.Resolution</div>
                    }
                </td>

                <!-- Seri No -->
                <td>
                    @item.ProductStocks.FirstOrDefault()?.SeriNumber
                </td>
            </tr>
        }
    </tbody>
</table>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/homeindex.css" />
}

@section Scripts {
    <script src="~/js/site.js"></script>
}
