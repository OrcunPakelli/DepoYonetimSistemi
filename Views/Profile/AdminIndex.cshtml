@model IEnumerable<DepoYonetimSistemi.Models.User>
@{
    ViewData["Title"] = "Kullanıcılar";
}

<form id="deleteSelectedForm" asp-controller="Profile" asp-action="DeleteSelectedUsers" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" name="ids" id="selectedIds" />
</form>

<!--Kullanıcı tablosu-->
<div class="Table">
    <div class="TableHeader">
        <h2 class="mb-0">Kullanıcı Listesi</h2>

        <div class="Buttons">
            <button type="button" class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#createUserModal">
                <i class="fas fa-user-plus"></i> Kullanıcı Ekle
            </button>

            <button type="button" class="btn btn-danger" id="btnDeleteSelected" data-bs-toggle="modal"
                data-bs-target="#deleteSelectedModal" disabled>
                Seçilenleri Sil
            </button>
        </div>
    </div>

    @if (TempData["Msg"] != null)
    {
        <div class="alert alert-success">@TempData["Msg"]</div>
    }
    @if (TempData["Err"] != null)
    {
        <div class="alert alert-danger">@TempData["Err"]</div>
    }
    <table class="styled-table">
        <thead>
            <tr>
                <th>Seç</th>
                <th>kullanıcı Adı</th>
                <th>Rol</th>
                <th>Oluşturulma Tarihi</th>
                <th></th>

            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model)
            {
                <tr>
                    <td>
                        <input type="checkbox" class="user-check" value="@user.UserId" />
                    </td>
                    <td>@user.UserName</td>
                    <td>@user.Role</td>
                    <td>@user.CreatedAt</td>
                    <td>
                        <button type="button" class="btn btn-sm btn-warning js-open-passmodal" data-bs-toggle="modal"
                            data-bs-target="#changePassModal" data-userid="@user.UserId" data-username="@user.UserName">
                            Şifre Değiştir
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Depo tablosu---->
<div class="Table">
    <div class="TableHeader">
        <h2 class="mb-0">Depolar</h2>

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addComponentModal">
            <i class="fas fa-microchip"></i> Bileşen Ekle
        </button>

        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addWarehouseModal">
            <i class="fas fa-warehouse"></i> Depo Ekle
        </button>

    </div>

    <table class="styled-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Depo Adı</th>
            </tr>
        </thead>
        <tbody>
            @if (ViewBag.Warehouses != null)
            {
                foreach (var w in ViewBag.Warehouses)
                {
                    <tr>
                        <td>@w.WarehouseId</td>
                        <td>@w.WarehouseName</td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<!-- Şifre değiştirme modal -->
<div class="modal fade" id="changePassModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Şifre Değiştir</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
            </div>

            <form asp-controller="Profile" asp-action="AdminChangePassword" method="post">
                @Html.AntiForgeryToken()

                <div class="modal-body">
                    <input type="hidden" id="modalUserId" name="userId" />

                    <div class="mb-2 text-muted">
                        Kullanıcı: <b id="modalUsername"></b>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Yeni Şifre</label>
                        <input type="password" class="form-control" name="newPassword" required minlength="4" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Yeni Şifre (Tekrar)</label>
                        <input type="password" class="form-control" name="confirmPassword" required minlength="4" />
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="submit" class="btn btn-primary">Kaydet</button>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- Kullanıcı Oluşturulma modal -->
<div class="modal fade" id="createUserModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Kullanıcı Ekle</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form asp-controller="Profile" asp-action="CreateUser" method="post">
                @Html.AntiForgeryToken()

                <div class="modal-body">

                    <div class="mb-3">
                        <label class="form-label">Kullanıcı Adı</label>
                        <input name="userName" class="form-control" required minlength="3" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Şifre</label>
                        <input name="password" type="password" class="form-control" required minlength="4" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Şifre (Tekrar)</label>
                        <input name="confirmPassword" type="password" class="form-control" required minlength="4" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Rol</label>
                        <select name="userRole" class="form-select">
                            <option value="@((int)UserRole.Employee)">Çalışan</option>
                            <option value="@((int)UserRole.Manager)">Manager</option>
                            <option value="@((int)UserRole.SystemAdmin)">SystemAdmin</option>
                        </select>
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="submit" class="btn btn-success">Kaydet</button>
                </div>
            </form>

        </div>
    </div>
</div>

<!-- Kullanıcı silme modal-->
<div class="modal fade" id="deleteSelectedModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Seçilen Kullanıcıları Sil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <p class="mb-2">
                    <b id="selectedCount">0</b> kullanıcı silinecek. Emin misin?
                </p>
                <div class="text-muted small">
                    Not: Bu işlem geri alınamaz.
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteSelected">Sil</button>
            </div>

        </div>
    </div>
</div>

<!-- Depo ekleme modal-->
<div class="modal fade" id="addWarehouseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Depo Ekle</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form asp-controller="Profile" asp-action="AddWarehouse" method="post">
                @Html.AntiForgeryToken()

                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Depo Adı</label>
                        <input type="text" name="warehouse" class="form-control" required />
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        İptal
                    </button>
                    <button type="submit" class="btn btn-success">
                        Kaydet
                    </button>
                </div>

            </form>

        </div>
    </div>
</div>

<div class="modal fade" id="addComponentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Bileşen Ekle</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <div class="mb-3">
                    <label class="form-label">Bileşen Türü</label>
                    <select id="componentTypeSelect" class="form-select">
                        <option value="">Seçiniz</option>
                        <option value="cpu">CPU</option>
                        <option value="gpu">GPU</option>
                        <option value="storage">Storage</option>
                        <option value="screen">Screen</option>
                        <option value="ram">RAM</option>
                    </select>
                </div>

                <!-- CPU -->
                <form asp-action="AddCpu" asp-controller="Profile" method="post" class="component-form" id="cpuForm">
                    @Html.AntiForgeryToken()

                    <div class="mb-2">
                        <label class="form-label">Model</label>
                        <input name="Model" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Üretici</label>
                        <input name="Manufacturer" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Çekirdek Sayısı</label>
                        <input name="Cores" type="number" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Thread Sayısı</label>
                        <input name="Threads" type="number" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Base Clock (GHz)</label>
                        <input name="BaseClockGHz" type="number" step="0.1" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Boost Clock (GHz)</label>
                        <input name="BoostClockGHz" type="number" step="0.1" class="form-control" />
                    </div>

                    <button class="btn btn-success">CPU Kaydet</button>
                </form>

                <!-- GPU -->
                <form asp-action="AddGpu" asp-controller="Profile" method="post" class="component-form" id="gpuForm">
                    @Html.AntiForgeryToken()

                    <div class="mb-2">
                        <label class="form-label">Model</label>
                        <input name="Model" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Üretici</label>
                        <input name="Manufacturer" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Bellek</label>
                        <input name="Memory" class="form-control" />
                    </div>

                    <button class="btn btn-success">GPU Kaydet</button>
                </form>
                <!-- Storage -->
                <form asp-action="AddStorage" asp-controller="Profile" method="post" class="component-form"
                    id="storageForm">
                    @Html.AntiForgeryToken()

                    <div class="mb-2">
                        <label class="form-label">Model</label>
                        <input name="Model" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Üretici</label>
                        <input name="Manufacturer" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Tür</label>
                        <input name="Type" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Kapasite (GB)</label>
                        <input name="CapacityGB" type="number" class="form-control" />
                    </div>

                    <button class="btn btn-success">Storage Kaydet</button>
                </form>

                <!-- Screen -->
                <form asp-action="AddScreen" asp-controller="Profile" method="post" class="component-form"
                    id="screenForm">
                    @Html.AntiForgeryToken()

                    <div class="mb-2">
                        <label class="form-label">Ekran Boyutu (inç)</label>
                        <input name="SizeInches" type="number" step="0.1" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Çözünürlük</label>
                        <input name="Resolution" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Yenileme Hızı (Hz)</label>
                        <input name="RefreshRate" type="number" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Panel Tipi</label>
                        <input name="PanelType" class="form-control" />
                    </div>

                    <button class="btn btn-success">Ekran Kaydet</button>
                </form>
                <!-- Ram -->
                <form asp-action="AddRam" asp-controller="Profile" method="post" class="component-form" id="ramForm">
                    @Html.AntiForgeryToken()

                    <div class="mb-2">
                        <label class="form-label">Model</label>
                        <input name="Model" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Üretici</label>
                        <input name="Manufacturer" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">RAM Tipi</label>
                        <input name="Type" class="form-control" />
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Kapasite (GB)</label>
                        <input name="SizeGB" type="number" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Hız (MHz)</label>
                        <input name="SpeedMHz" type="number" class="form-control" />
                    </div>

                    <button class="btn btn-success">RAM Kaydet</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/AdminIndex.css" />
}

@section Scripts {
    <script src="~/js/Profile.js"></script>
}
